% !Mode:: "TeX:UTF-8"
%% 请使用 XeLaTeX 编译本文.
% \documentclass{WHUBachelor}% 选项 forprint: 交付打印时添加, 避免彩色链接字迹打印偏淡. 即使用下一行:
  \documentclass[forprint]{WHUBachelor}

  \begin{document}
  %%%%%%% 下面的内容, 据实填空.
  
  \miji{ 2016级}                                      % 密级. 没有就空着.
  \StudentNumber{16337259(谢江钊)} % 填写自己的学号
  
  \title{基于流水线CPU的分支预测技术性能研究}
  \Etitle{Research on the Performance of Branch Prediction Technology Based on Pipeline CPU} % 英文题目
  \author{谢江钊\quad 徐正金}                            % 作者名字
  \Eauthor{Xie Jiangzhao\quad Xv Zhengjin}            %作者英文名
  \Csupervisor{李国桢\quad 教授}        %指导教师中文名、职称
  \Esupervisor{Prof.~Li Guozhen}     %指导教师英文名、职称
  \Cmajor{计算机类}                  % 专业中文名
  \Emajor{Computer Class}% 专业英文名
  \Cschoolname{数据科学与计算机学院}          % 学院名
  \Eschoolname{School of Data and Computer Science} %学院英文名. 不确定的话, 请看一下自己学院的网页上是怎么写的. 别搞错了!
  \date{二〇一八年一月}                    % 日期, 要注意和英文日期一致!!
  \Edate{January, 2018}                       % 英文封面日期
  
  %-----------------------------------------------------------------------------
  \pdfbookmark[0]{封面}{title}         % 封面页加到 pdf 书签
  \maketitle
  \frontmatter
  \pagenumbering{Roman}              % 正文之前的页码用大写罗马字母编号.
  %-----------------------------------------------------------------------------
  \include{includefile/frontmatter}    % 加入摘要, 申明.
  %==========================把目录加入到书签==============================%%%%%%
  \pdfbookmark[0]{目录}{toc}
  \tableofcontents
  \mainmatter %% 以下是正文
  %%%%%%%%%%%%%%%%%%%%%%%%%%%--------main matter-------%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  \chapter{绪论}
   \section{分支预测算法的意义}
  
   分支预测器的重要性在课本中已经得到相当详尽的论述，在这里就不再从原理上去解释它了。回到工业生产中去，
近年来CPU的发展是巨大的，技术的更新集中在更高的制程，频率，深流水线，指令集并行，超线程技术等等上。其中
的流水线加深，更是使得条件分支带来的控制冲突变得日趋严重。分支预测进行得不准确，意味着预测的指令全部都
要抛弃不再进行，这一点会导致极大的性能浪费。其中，奔腾4便是一个失败的例子。奔腾4采用的31级超长流水线，
把主频提高到了3Ghz以上，但是性能却比不过同时期低主频14级流水线的AMD处理器，其中一个重要的原因便是没有
采用高效的分支预测器，导致流水线中断问题极其严重，导致了性能的严重下降。今天的CPU普遍采用14-16级流水线原因之一，
便是分支预测技术瓶颈。\par
业界引入了动态分支预测技术，开发出多种预测方案，使得控制冲突逐渐得到解决。其中较为贴近现代的便是局部分支
预测器，全局分支预测器，循环分支预测器以及间接分支预测器等等，在这里我将对一部分方案作出解释。另外，由
S. McFarling提出的混合（融合）分支预测器相比之下会有更加好的预测结果，同样非常值得考虑作为CPU预测器
发展的方向。\par
更前沿地，当前高端CPU已经迈进了神经网络预测以及多种预测器相结合的道路，在这里由于技术过于复杂便不再进行赘述。
预测器的发展需要考虑到速度和效果，这一点也是需要企业来进行权衡的。如何平衡两者的关系，也是未来发展的一个重点。
做这个项目的时候感触良多，对指令执行特点和CPU自身设计有了很多的体会。而这一个项目实现的内容将来也能够不断改进，
作为未来的教学预测性能预测手段。
  \section{技术发展现状与趋势}\label{sec-compile}

  \subsection{静态分支预测技术}
静态分支技术是最简单的技术，分为两种，强制跳转或强制不跳，而不依赖于过去的历史记录。后来的技术变得更加复杂，假定了
向后分支必然发生，而向前的分支不会发生，对应着程序设计中经常使用到的for循环和if判断特性，能够更好地进行预测。在
早期的时候一些处理器甚至允许分支预测提示出现在代码中，但是后来便不再采用。对于这种做法，理论上是不应该存在的，对于
程序员来说，底层的CPU实现应该做到透明，而不是反过来去负责做分支预测。\par
静态分支预测技术的优点在于对硬件实现基本没有要求，但是预测的效果却见不得理想，尤其对于日渐复杂的程序而言，其准确率
是不能够被接受的。


  \subsection{1bit分支预测器}
1bit分支预测器引入了一位分支预测缓存,记录分支最后一次的选择，然后预测下一次也做出同样的决定。但是这种预测方法有一个
问题在于，如果遇到TFTFTFT...的情况，会造成大量的空翻，从而使得性能被严重浪费。并且由于其总是预测分支跳转/不跳转一定
发生，一旦出现例外情况就会造成两次错误。为了解决这个问题，引入2bit分支预测器，来给预测引入一个缓冲区域。

  
  
  
  \subsection{2bit分支预测器}
2bit分支预测器是基于饱和计数器进行的，饱和计数器是一个拥有4个状态的状态机:强跳转，弱跳转，弱不跳转，他们之间的相互转换关系如下:\par
这种方法的优点在于指令必须选择某个分支连续两次，才能够实现状态的翻转，进而改变预测的分支。回到刚才的情况，一开始的时候
饱和计数器处于强跳转的状态，那么一次F的影响只能使计数器回到弱跳转状态，避免了接连的空翻，相比之下错误率下降。同样的道理，
我们还可以提出nbit分支预测器，来给予更多的缓冲空间，但是这种做法也导致了跳转不能够灵活地得到改变，在测试中反而导致预测率
下降。

 \subsection{局部分支预测器}
 前面所描述的2bit分支预测器，用状态机的办法把过去若干条指令改变的结果保存了下来，但是这样有一个问题，认为本次的跳转与
 之前的若干条指令跳转有关，但是处理起来却把本次预测结果应该基于过去的情况。举个例子，假如之前的几次跳转结果是TTF，那么
 这一次的结果如果仅仅看作前几次的衍生的话，便有可能出错。例如对于一个循环而言，循环3次跳转最后一次不跳转(跳出循环)，如果
 依靠2bit分支预测器就会出现预测错误的结果，因为前三次的跳转不能够表明这一次也一定跳转。相对应的是，我们可以把前三次的历史
 记录看作是一种模式，然后在此基础上构建饱和计数器，经过若干次训练，便可以得到一个结果:三次的跳转必然伴随着一次结果，这样我们
 往后的预测便会变得准确，提高了我们的正确率。\par
 局部分支预测器构建了两个表:一个被称为BHT(Branch History Table)，另一个被称为BPT(Branch Pattern Table)。
  
  
  \chapter{杂七杂八的话}
  
  \section{Readme}
  
  模板文件的结构, 如下表所示:
   \begin{table}[ht]\centering
  \begin{tabular}{r|r|l}
    \hline\hline
    \multicolumn{2}{l|}{Bachelor-template.tex }       & 主文档. 在其中填写正文.             \\ \hline
                                    & frontmatter.tex & 郑重声明、中英文摘要.               \\ \cline{2-3}
    \raisebox{1em}{includefile 文件夹} &  backmatter.tex & 致谢.                       \\ \hline
    \multicolumn{2}{l|}{figures 文件夹}                  & 存放图片文件.                   \\ \hline
    \multicolumn{2}{l|}{WHUBachelor.cls }             & 定义文档格式的 class file. 不可删除. \\ \hline\hline
  \end{tabular}
  \end{table}
  
  无需也不要改变、移动上述文档的位置.
  
  如果不习惯用~\verb|\include{ }|~的方式加入``子文档'', 当然可以把它们合并在主文档, 成为一个文档.
  ({\kaishu 但是这样并不会给我们带来方便.})
  
  利用~WinEdt~的~Project tree, 可以方便地管理这些文件:
  \begin{itemize}
      \item 点击~WinEdt~窗口的~Project Tree~按键;
      \item 再点击~WinEdt~窗口的~Set Main File~按键;
  \end{itemize}
  接下来的管理, 已经清楚地展示在跳出的窗口中了. 再去处理其他的文件时, 还要点击~WinEdt~窗口的~Remove Main File~按键.
  
  
  \section{更新记录}
  2016 年 06 月更新: 正文字体为小四号; 英文字体为 Times New Roman; 修订图表标题的字体、字号; 修订目录的字号; 修订附录章节编号的问题. 
                            非常感谢武汉大学数学与统计学院 2012 级张仕俊、林颖倩、宋俍辰等同学. 
  
  2016 年 05 月更新: 参考文献加到目录. 感谢武汉大学经济与管理学院的郑中天同学. [上次修订使用的版本有误, 非常抱歉.]
  
  2016 年 02 月更新: 调整为适应 TeX Live 2015 的版本.
  
  2014 年 06 月更新: 修改章节标题、声明标题、图表标题的字体和大小. 再次感谢孙启航同学.
  
  2014 年 05 月更新: 参考文献加到目录. 感谢武汉大学计算机学院孙启航同学、数学与统计学院李振坤同学指出这个纰漏.
  
  2013 年 12 月更新: 加上英文封面. 教务部的写作规范中的附例, 并没有英文封面. 但是遇到很多同学说要加上.
  
  
   \section{字体调节}
  
  \begin{tabular}{ll}
    \verb|\songti|   & {\songti 宋体}   \\
    \verb|\heiti|    & {\heiti 黑体}    \\
    \verb|\fangsong| & {\fangsong 仿宋} \\
    \verb|\kaishu|   & {\kaishu 楷书}
  \end{tabular}
  
  
  \section{字号调节}
  字号命令: \verb|\zihao| \index{zihao}
  
  \begin{tabular}{ll}
  \verb|\zihao{0}| &\zihao{0}  初号字 English \\
  \verb|\zihao{-0}|&\zihao{-0} 小初号 English \\
  \verb|\zihao{1} |&\zihao{1}  一号字 English \\
  \verb|\zihao{-1}|&\zihao{-1} 小一号 English \\
  \verb|\zihao{2} |&\zihao{2}  二号字 English \\
  \verb|\zihao{-2}|&\zihao{-2} 小二号 English \\
  \verb|\zihao{3} |&\zihao{3}  三号字 English \\
  \verb|\zihao{-3}|&\zihao{-3} 小三号 English \\
  \verb|\zihao{4} |&\zihao{4}  四号字 English \\
  \verb|\zihao{-4}|&\zihao{-4} 小四号 English \\
  \verb|\zihao{5} |&\zihao{5}  五号字 English \\
  \verb|\zihao{-5}|&\zihao{-5} 小五号 English \\
  \verb|\zihao{6} |&\zihao{6}  六号字 English \\
  \verb|\zihao{-6}|&\zihao{-6} 小六号 English \\
  \verb|\zihao{7} |&\zihao{7}  七号字 English \\
  \verb|\zihao{8} |&\zihao{8}  八号字 English \\
  \end{tabular}
  
  \section{已加入的常用宏包}
  
  \begin{description}
  %  \item[amsmath,amssymb]
    \item[cite]  参考文献引用, 得到形如 [3-7] 的样式.
    \item[color,xcolor]  支持彩色.
    \item[enumerate]  方便自由选择 enumerate 环境的编号方式. 比如
  
    \verb|\begin{enumerate}[(a)]| 得到形如 (a), (b), (c) 的编号.
  
  
    \verb|\begin{enumerate}[i)]| 得到形如 i), ii), iii) 的编号.
  
  \end{description}
  
  另外要说明的是,  itemize, enumerate, description 这三种 list 环境, 已经调节了其间距和缩进,
  以符合中文书写的习惯.
  
  \section{标点符号的问题}
  
  建议使用半角的标点符号, 后边再键入一个空格. 特别是在英文书写中要注意此问题!
  
  双引号是由两个左单引号、两个右单引号构成的: \verb|``  ''|. 左单引号在键盘上数字~1 的左边.
  
  但是, 无论您偏向于全角或半角, 强烈建议您使用实心的句号, 只要您书写的是自然科学的文章.
  原因可能是因为, 比如使用全角句号的句子结尾处的``$x$。''容易误为数学式~$x_0$(\verb|$x_0$|)吧.
  
  
  
  \section{引用的问题}
  
  
  \subsection{参考文献的引用}
  
  参考文献的引用, 用命令~\verb|\cite{ }|. 大括号内要填入的字串, 是自命名的文献条目名.
  
  比如, 通常我们会说:
  
   {\kaishu
  关于此问题, 请参见文献 \cite{r2}. 作者某某还提到了某某概念\upcite{r1}.}
  
  
  上文使用的源文件为:
  
   {\kaishu
  关于此问题, 请参见文献~\verb|\cite{r2}|. 作者某某还提到了某某概念~\verb|\upcite{r1}|.
  }
  
  其中~\verb|\upcite| 是自定义命令, 使文献引用呈现为\CJKunderdot{上标形式}.
  
  ({\heiti 注意:} {\kaishu 这里文献的引用, 有时需要以上标形式出现, 有时需要作为正文文字出现, 为什么?})
  
  另外, 要得到形如~\cite{r1,r3,r4,r5} 的参考文献连续引用, 需要用到 cite 宏包(模板已经加入),
  在正文中使用~\verb|\cite{r1,r3,r4,r5}| 的引用形式即可.
  或者, 连续引用的上标形式: 使用~\verb|\upcite{r1,r2,r3}|, 得到\upcite{r1,r2,r3}.
  
  \subsection{定理和公式的引用}
  
  \begin{theorem}[谁发现的]\label{th-abcd}
  最大的正整数是~$1$.
  \end{theorem}
  
  \begin{proof}
  要找到这个最大的正整数, 我们设最大的正整数为~$x$, 则~$x \geqslant 1$, 两边同时乘以~$x$, 得到
  \begin{equation}\label{eq-abc}
  x^2 \geqslant x.
  \end{equation}
  而~$x$ 是最大的正整数, 由~\eqref{eq-abc} 式得到
  \[
  x^2 = x.
  \]
  所以
  \begin{equation*}
  x = 1.
  \end{equation*}
  \end{proof}
  
  定理~\ref{th-abcd} 是一个重大的发现.
  
  %%%%----- 定义等环境的举例 --------
  \begin{definition}[整数]
   正整数(例如 1, 2, 3)、负整数(例如 ${−1}$, $−2$, $−3$)与零(0)合起来统称为{\heiti 整数}.
  \end{definition}
  
  \begin{remark}
    整数集合在数学上通常表示为 $\mathbf{Z}$ 或 $\mathbb{Z}$, 该记号源于德语单词 Zahlen(意为``数'')的首字母.
  \end{remark}
  
  \begin{proposition}
  任意两个整数相加、相减、相乘的结果, 仍然是整数.
  \end{proposition}
  
  \begin{example}
    $1+2=3$.
  \end{example}
  
  \begin{corollary}
     在整数集合内, 相加、相减、相乘运算是封闭的.
  \end{corollary}
  
  \section{图形与表格}
  
  支持对~eps, pdf, jpg 等等常见图形格式.
  
  再次\colorbox{red!45}{澄清一个误会}: \LaTeX{} 支持的图形格式绝非 eps 这一种. 无需特意把图片转化为 eps.
  
  用形如~\verb|\includegraphics[width=12cm]{Daisy.jpg}| 的命令可以纳入图片.
  
  如图~\ref{fig:1} 是一个纳入~jpg 图片的例子.
  
  \begin{figure}[ht]
  \centering
    \includegraphics[width=\textwidth]{Daisy.jpg}
    \caption{一个彩色 jpg 图片的例子}
    \label{fig:1}
  \end{figure}
  
  表格问题, 建议使用``三线表'', 如表 \ref{tab:1}.
  
  \begin{table}[ht]
  \centering
  \caption{一般三线表}
  \label{tab:1}
      \begin{tabular}{c c c c c c c c c c c}
      \hline
      123 & 4  & 5  & 123 & 4 & 5123 & 4 & 5 & 123 & 4 & 5\\
      \hline
      67 & 890 & 13 & 123 & 4 & 5123 & 4 & 5 & 123 & 4 & 5\\
      67 & 890 & 13 & 123 & 4 & 5123 & 4 & 5 & 123 & 4 & 5\\
      67 & 890 & 13 & 123 & 4 & 5123 & 4 & 5 & 123 & 4 & 5\\
      \hline
      \end{tabular}
  \end{table}
  
  
  
  
  
  
  %%%%============================================================================================================%%%
  
  \chapter{其他事项}
  以下是广告时间, 插播一段广告:
  \begin{itemize}
      \item 插图\index{插图}的制作, 建议用 pgf, 也叫 tikz.
            pgf 的长处是源文件直接植入~\TeX~文档, 管理起来非常方便.
      这里有我写的一个关于初次使用~pgf~的帖子:\\    \url{http://bbs.ctex.org/forum.php?mod=viewthread&tid=30480}.
      \item 生成参考文献, 建议使用~BibTeX.\index{BibTeX} 这里有我写的一个文档: \\
      \url{http://bbs.ctex.org/forum.php?mod=viewthread&tid=26056}.
  
            {\kaishu 使用 BibTeX{} 做参考文献时,
        借助 EndNote 或者 NoteExpress, 可以非常漂亮简单地解决 bib 文件的录入问题.
        NoteExpress 在校图书馆网站有正版软件提供下载.
        当然 EndNote 本身就是 Thomson Corporation 推出的(和 SCI 搜索引擎是同一家公司),
        和多个重要文献搜索引擎有良好的功能配合.
  
        Google 学术搜索也提供了文献的 bib 格式.
        录入参考文献时, 偶尔用一用 Google 学术搜索, 还可以核查或减少录入的错误, 并减少录入的工作量.}
  
      \item 幻灯片\index{幻灯片}的制作, 建议使用~Beamer. 这里有我写的一个模板, 谨供参考:\\
      \url{http://bbs.ctex.org/forum.php?mod=viewthread&tid=27695}.
  \end{itemize}
  
  
  %%%============================================================================================================%%%
  
  %%%=== 参考文献 ========%%%
  \cleardoublepage\phantomsection
  \addcontentsline{toc}{chapter}{参考文献}
  \begin{thebibliography}{00}
  
    \bibitem{r1} 作者. 文章题目 [J].  期刊名, 出版年份，卷号(期数): 起止页码.
  
    \bibitem{r2} 作者. 书名 [M]. 版次. 出版地：出版单位，出版年份：起止页码.
  
    \bibitem{r3} 邓建松等, 《\LaTeXe~科技排版指南》, 科学出版社.
  
    \bibitem{r4} 吴凌云, 《CTeX~FAQ (常见问题集)》, \textit{Version~0.4}, June 21, 2004.
  
    \bibitem{r5} Herbert Vo\ss, Mathmode, \url{http://www.tex.ac.uk/ctan/info/math/voss/mathmode/Mathmode.pdf}.
  
  
  \end{thebibliography}
  
  \include{includefile/backmatter} %%%致谢
  
  %%%-------------- 附录. 不需要可以删除.-----------
  \appendix
  
  \chapter{测试}
  
  \section{第一个测试}
  测试公式编号
  \begin{equation}
  1+1=2.
  \end{equation}
  
  表格编号测试
  
  \begin{table}[h]
    \centering
    \caption{测试表格}
    \begin{tabular}{*{20}c}
       \hline
       % after \\: \hline or \cline{col1-col2} \cline{col3-col4} ...
       11 & 13  & 13  & 13  & 13 \\
       12 & 14  & 13  & 13  & 13 \\
       \hline
     \end{tabular}
  \end{table}
  
  
  \chapter{附录测试}
  
  测试
  
  \chapter{附录测试}
  
  测试
  
  \cleardoublepage
  \end{document}
  
  
  
  